CC=@CC@
CXX=@CXX@

BUILD_SRC=../../src
ROOT_SRC=@srcdir@/../../src
ROOT_TESTS_DGA=@srcdir@

CFLAGS=-g -fPIC -DPIC -I$(ROOT_SRC)/include -I$(BUILD_SRC)/include @JSONC_CFLAGS@ @PCAP_INC@ @CFLAGS@
LIBNDPI=$(BUILD_SRC)/.libs/libndpi.a
LDFLAGS=$(LIBNDPI) @PCAP_LIB@ @LIBS@ @JSONC_LIBS@ -lpthread @LDFLAGS@
HEADERS=$(BUILD_SRC)/include/ndpi_api.h $(ROOT_SRC)/include/ndpi_typedefs.h $(ROOT_SRC)/include/ndpi_protocol_ids.h
OBJS=dga_evaluate
PREFIX?=@prefix@

all: dga_evaluate

dga_evaluate: $(LIBNDPI) dga_evaluate.o
	$(CC) $(CFLAGS) dga_evaluate.o -o $@ $(LDFLAGS)

%.o: $(ROOT_TESTS_DGA)/%.c $(HEADERS) Makefile
	$(CC) $(CFLAGS) -c $< -o $(notdir $@)

clean:
	/bin/rm -f *.o dga_evaluate
	/bin/rm -f .*.o.cmd .*.o.d
	/bin/rm -rf build

install:
	echo ""

distdir:
	cp \
		$(ROOT_TESTS_DGA)/dga_evaluate.c \
		$(ROOT_TESTS_DGA)/README.md \
		$(ROOT_TESTS_DGA)/test_dga.csv \
		$(ROOT_TESTS_DGA)/test_non_dga.csv \
		'$(distdir)/'

distclean: clean
	/bin/rm -f Makefile
